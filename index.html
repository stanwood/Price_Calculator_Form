<html>
<head>
</head>
<body>
<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<script charset="utf-8" type="text/javascript" src="https://js.hsforms.net/forms/v2.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<!--[if lte IE 8]>
<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
<![endif]-->
<style>
	.hs-form-field {
		padding: 0 50px 0 0 !important;
	}
	form h1 {
		background: #EEEEEE;
		padding: 20px;
	}
	input {
		margin-right: 10px;
		margin-bottom: 10px;
		margin-top: 10px;
	}
	h1 {
		font-size: 20px !important;
	}
	.padding20tb {
		padding: 0px !important;
	}
	input[type="radio"], input[type="checkbox"] {
		height: 20px !important;
		width: 20px !important;
	}
</style>
<script charset="utf-8" type="text/javascript" src="https://js.hsforms.net/forms/v2.js"></script>
<script>
  hbspt.forms.create({
	portalId: "4628060",
	formId: "1ac1f8dd-38c0-4bb3-8105-d92f07e27593"
});
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
	window.addEventListener('message', function(event) {

		if(event.data.type === 'hsFormCallback' && event.data.eventName === 'onFormReady') {

			var form = document.getElementsByTagName("form")[0];

			// Dev enviroment
			if (form == undefined) {
				form = event.source.document.getElementsByTagName("form")[0];
			}

			for (var i = 0; i < form.length; i++) {
				form[i].addEventListener('change',updateValue);
			}

			function updateValue(e) {

				var prices = {
					default: 5,
					perPlatform: {
						social: 10,
						offline: 50
					},
					perView: {
						master: 2,
						detail: 2,
						form: 4
					}
				}

				var totalPrice = prices.default * 3; //3 = Wireframes, Design, Estimation

				var details = "<table class='cost-details'>";
				details += "<tr><th>Feature</th><th>Android</th><th>iOS</th><th>Web</th><th>Gesamt</th></tr>";
				details += "<tr><td>Beratung</td><td></td><td></td><td></td><td>5000 &euro;</td></tr>";
				details += "<tr><td>Konzeption</td><td></td><td></td><td></td><td>5000 &euro;</td></tr>";
				details += "<tr><td>Design</td><td></td><td><td></td></td><td>5000 &euro;</td></tr>";
				//details += "<tr><td></td><td></td><td></td><td></td></tr>";

				var isAndroid = 0;
				var isiOS = 0;
				var isWeb = 0;

				// Number of platforms
				var numberOfPlatforms = 0;
				var platforms = e.target.getRootNode().getElementsByName("platform")
				for (var i = 0; i < platforms.length; i++) {
					if (platforms[i].checked) {
						numberOfPlatforms++;

						if (platforms[i].value == "Android") {
							isAndroid = 1;
						}
						if (platforms[i].value == "iOS") {
							isiOS = 1;
						}
						if (platforms[i].value == "Web") {
							isWeb = 1;
						}
					}
				}

				// Views

				var numberOfMasterViews = e.target.getRootNode().getElementsByName("number_master_views")[0].value;
				var numberOfEditViews = e.target.getRootNode().getElementsByName("number_edit_views")[0].value;

				details += "<tr><td>Einfache Ansichten<br><label>(a 2000 &euro;)</label></td><td>" + numberOfMasterViews * isAndroid * 2000 + " &euro;</td><td>" + numberOfMasterViews * isiOS * 2000 + " &euro;</td><td>" + numberOfMasterViews * isWeb * 2000 + " &euro;</td><td>" + (isAndroid + isiOS + isWeb) * numberOfMasterViews * 2000 + " &euro;</td></tr>";
				details += "<tr><td>Komplexe Ansichten<br><label>(a 4000 &euro;)</label></td><td>" + numberOfEditViews * isAndroid * 4000 + " &euro;</td><td>" + numberOfEditViews * isiOS * 4000 + " &euro;</td><td>" + numberOfEditViews * isWeb * 4000 + " &euro;</td><td>" + (isAndroid + isiOS + isWeb) * numberOfEditViews * 4000 + " &euro;</td></tr>";

				var priceFeatures = 0;

				// Additional features
				var additionalFeatures = e.target.getRootNode().getElementsByName("additional_features");
				for (var i = 0; i < additionalFeatures.length; i++) {
					if (additionalFeatures[i].checked) {
						var pricePerFeature = 0;
						switch (additionalFeatures[i].value) {
							case "Erstellen von PDFs (Rechnungen etc.)":
								pricePerFeature = 10;
								break;
							case "Analyse der App-Nutzung":
								pricePerFeature = 10;
								break;
							case "Nachrichten schreiben (wie in Whatsapp)":
								pricePerFeature = 10;
								break;
							case "Kommentieren und \"Liken\"":
								pricePerFeature = 10;
								break;
							case "Offline Speichern":
								pricePerFeature = 50;
								break;
							default:
								pricePerFeature = 5;
						}
						priceFeatures += pricePerFeature

						details += "<tr><td>" + additionalFeatures[i].value + "</td><td>" + isAndroid * pricePerFeature * 1000 + " &euro;</td><td>" + isiOS * pricePerFeature * 1000 + " &euro;</td><td>" + isWeb * pricePerFeature * 1000 + " &euro;</td><td>" + (isAndroid + isiOS + isWeb) * pricePerFeature * 1000 + " &euro;</td></tr>";
					}
				}

				// Advanced features
				var advancedFeatures = e.target.getRootNode().getElementsByName("advanced_features");
				for (var i = 0; i < advancedFeatures.length; i++) {
					if (advancedFeatures[i].checked) {
						var pricePerFeature = 0;
						switch (advancedFeatures[i].value) {
							case "Erstellen von PDFs (Rechnungen etc.)":
								pricePerFeature += 10;
								break;
							case "Analyse der App-Nutzung":
								pricePerFeature += 10;
								break;
							default:
								pricePerFeature += 5;
								break;
						}

						priceFeatures += pricePerFeature;

						details += "<tr><td>" + advancedFeatures[i].value + "</td><td>" + isAndroid * pricePerFeature * 1000 + " &euro;</td><td>" + isiOS * pricePerFeature * 1000 + " &euro;</td><td>" + isWeb * pricePerFeature * 1000 + " &euro;</td><td>" + (isAndroid + isiOS + isWeb) * pricePerFeature * 1000 + " &euro;</td></tr>";
					}
				}

				// CMS

				var contentManagementSystem = e.target.getRootNode().getElementsByName("content_management_system");

				// Number of platforms
				var priceCMS = 0;
				for (var i = 0; i < contentManagementSystem.length; i++) {
					if (contentManagementSystem[i].checked) {
						switch (contentManagementSystem[i].value) {
							case "High end":
								priceCMS += 30;
								break;
							case "Nein":
								priceCMS += 0;
								break;
							default:
								priceCMS += 10;
								break;
						}

						console.log(contentManagementSystem[i].value);

						details += "<tr><td>Content Management System<br><label>" + contentManagementSystem[i].value + "</label></td><td></td><td></td><td></td><td>" + priceCMS * 1000 + " &euro;</td></tr>";
					}
				}

				var totalPrice = totalPrice + (priceFeatures + numberOfMasterViews * 2 + numberOfEditViews * 4) * numberOfPlatforms + priceCMS;

				details += "<tr><td>GESAMT</td><td></td><td></td><td></td><td>" + totalPrice * 1000 + " &euro;</td></tr>";
				details += "</table><p>Ihr Projekt wird ca. " + Math.ceil((totalPrice * 1000) / (numberOfPlatforms  * 100 * 30 * 4 * 1.5)) + " Monate dauern.</p>"

				//Add "." between 000
				details = details.replace(/000 &euro;/g, ".000 &euro;");

				e.target.getRootNode().getElementsByName("cost_estimate")[0].value = totalPrice * 1000;
				e.target.getRootNode().getElementsByName("cost_details")[0].value = details;

				//For dev enviroment
				if (document.getElementById("table")) {
					document.getElementById("table").innerHTML = details;
				}

				//TRACKING
				if (e.eventPhase == 3) { // Those events are fired twice for some reason. Only tracking once.
					dataLayer.push({'form_field_name': e.target.name});
					dataLayer.push({'form_field_value': e.target.value + ": " + e.target.checked});
					dataLayer.push({'form_total_value': totalPrice});
					dataLayer.push({'form_total_string': details});
					dataLayer.push({'event': 'price_calculator_form_entry'});
				}
			}
		}
	});

</script>
<p id="table">
	Table
</p>
</body>
</html>